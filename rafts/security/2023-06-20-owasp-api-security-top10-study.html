<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 6.0.1 | Copyright Dean Attali 2023 -->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>OWASP API Security Top 10 Study</title>

  
  <meta name="author" content="Ganxiang Liu">
  

  <meta name="description" content="Summary This is my studying note of OWASP API Security Project. The page of OWASP API Security Project. The other OWASP Top 10 Series. Editions There are two ediitons of API Security Top 10, which are 2019 and 2023. Editions 2019 2023 ref : https://www.anquanke.com/post/id/288466 API Security Top 10 –...">

  

  
  <meta name="keywords" content="IT, Study, Security, Life, Travel, Books, Gourmet, Blog">
  

  
  <link rel="alternate" type="application/rss+xml" title="IT技術者的BLOG" href="http://localhost:4000/feed.xml">
  

  

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="IT技術者的BLOG">
  <meta property="og:title" content="OWASP API Security Top 10 Study">
  <meta property="og:description" content="Summary This is my studying note of OWASP API Security Project. The page of OWASP API Security Project. The other OWASP Top 10 Series. Editions There are two ediitons of API Security Top 10, which are 2019 and 2023. Editions 2019 2023 ref : https://www.anquanke.com/post/id/288466 API Security Top 10 –...">

  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Ganxiang Liu">
  <meta property="og:article:published_time" content="2023-06-20T00:00:00+09:00">
  <meta property="og:url" content="http://localhost:4000/security/2023-06-20-owasp-api-security-top10-study">
  <link rel="canonical" href="http://localhost:4000/security/2023-06-20-owasp-api-security-top10-study">
  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:site" content="@gxliu">
  <meta name="twitter:creator" content="@gxliu">

  <meta property="twitter:title" content="OWASP API Security Top 10 Study">
  <meta property="twitter:description" content="Summary This is my studying note of OWASP API Security Project. The page of OWASP API Security Project. The other OWASP Top 10 Series. Editions There are two ediitons of API Security Top 10, which are 2019 and 2023. Editions 2019 2023 ref : https://www.anquanke.com/post/id/288466 API Security Top 10 –...">

  

  


  

  

<link rel="icon" href="/favicon.ico">
</head>


<body>

  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="http://localhost:4000/">IT技術者的BLOG</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/aboutme">About Me</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/tags">Index</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Categories</a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/category/it.html">IT</a>
                  <a class="dropdown-item" href="/category/study.html">Study</a>
                  <a class="dropdown-item" href="/category/security.html">Security</a>
                  <a class="dropdown-item" href="/category/travel.html">Travel</a>
                  <a class="dropdown-item" href="/category/life.html">Life</a>
                  <a class="dropdown-item" href="/category/gourmet.html">Gourmet</a>
                  <a class="dropdown-item" href="/category/books.html">Books</a>
                  <a class="dropdown-item" href="/category/cat.html">Cat</a>
                  <a class="dropdown-item" href="/category/other.html">Other</a>
            </div>
          </li>
        
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources</a>
            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="https://beautifuljekyll.com">Beautiful Jekyll</a>
                  <a class="dropdown-item" href="https://www.markdowntutorial.com/">Learn markdown</a>
            </div>
          </li>
        
        <li class="nav-item">
          <a class="nav-link" id="nav-search-link" href="#" title="Search">
            <span id="nav-search-icon" class="fa fa-search"></span>
            <span id="nav-search-text">Search</span>
          </a>
        </li></ul>
  </div>

  

  
    <div class="avatar-container">
      <div class="avatar-img-border">
        <a href="http://localhost:4000/">
          <img alt="Navigation bar avatar" class="avatar-img" src="/assets/img/avatar-icon.png" />
        </a>
      </div>
    </div>
  

</nav>



<div id="beautifuljekyll-search-overlay">

  <div id="nav-search-exit" title="Exit search">✕</div>
  <input type="text" id="nav-search-input" placeholder="Search">
  <ul id="search-results-container"></ul>
  
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    var searchjson = '[ \
       \
        { \
          "title"    : "Chapter 21 Malicious Code and Application Attacks", \
          "desc"     : "Chapter 21 Malicious Code and Application Attacks", \
          "category" : "CISSPMalicious Code", \
          "url"      : "/study/2023-10-03-cissp-chapter21", \
          "date"     : "October  3, 2023" \
        }, \
       \
        { \
          "title"    : "脆弱性管理にSSVCを活用", \
          "desc"     : "脆弱性管理にSSVCを活用", \
          "category" : "SecurityCVSSSSVCSEV", \
          "url"      : "/security/2023-09-28-vuln-mgt-cvss-sev", \
          "date"     : "September 28, 2023" \
        }, \
       \
        { \
          "title"    : "AWS Security Services", \
          "desc"     : "AWS Security Services", \
          "category" : "AWSSecurity", \
          "url"      : "/security/2023-09-20-aws-security-services", \
          "date"     : "September 20, 2023" \
        }, \
       \
        { \
          "title"    : "DISQUSのコメント投稿機能を追加", \
          "desc"     : "DISQUSのコメント投稿機能を追加", \
          "category" : "Disqus", \
          "url"      : "/it/2023-09-17-add-disqus", \
          "date"     : "September 17, 2023" \
        }, \
       \
        { \
          "title"    : "My Hometown", \
          "desc"     : "My Hometown", \
          "category" : "hometown", \
          "url"      : "/life/2023-09-16-my-hometown", \
          "date"     : "September 16, 2023" \
        }, \
       \
        { \
          "title"    : "Migrate AWS EC2 WordPress to Github Pages", \
          "desc"     : "Migrate AWS EC2 WordPress to Github Pages", \
          "category" : "JekyllGithub PagesCloudflareSSL/TLS", \
          "url"      : "/it/2023-09-15-good-bye-aws-ec2-wp", \
          "date"     : "September 15, 2023" \
        }, \
       \
        { \
          "title"    : "在macOS上看网络电视", \
          "desc"     : "在macOS上看网络电视", \
          "category" : "Internet TV网络电视", \
          "url"      : "/life/2023-08-26-%E5%9C%A8macOS%E4%B8%8A%E7%9C%8B%E7%BD%91%E7%BB%9C%E7%94%B5%E8%A7%86", \
          "date"     : "August 26, 2023" \
        }, \
       \
        { \
          "title"    : "Coding Styles", \
          "desc"     : "Coding Styles", \
          "category" : "Coding Style", \
          "url"      : "/it/2023-07-21-coding-styles", \
          "date"     : "July 21, 2023" \
        }, \
       \
        { \
          "title"    : "ソフトウェアライセンスの学習メモ", \
          "desc"     : "ソフトウェアライセンスの学習メモ", \
          "category" : "Software License", \
          "url"      : "/study/2023-07-19-%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E3%81%AE%E5%AD%A6%E7%BF%92%E3%83%A1%E3%83%A2", \
          "date"     : "July 19, 2023" \
        }, \
       \
        { \
          "title"    : "OWASP Top 10", \
          "desc"     : "OWASP Top 10", \
          "category" : "owasptop10", \
          "url"      : "/security/2023-06-24-owasp-top10", \
          "date"     : "June 24, 2023" \
        }, \
       \
        { \
          "title"    : "OWASP API Security Top 10 Study", \
          "desc"     : "OWASP API Security Top 10 Study", \
          "category" : "owasptop10", \
          "url"      : "/security/2023-06-20-owasp-api-security-top10-study", \
          "date"     : "June 20, 2023" \
        }, \
       \
        { \
          "title"    : "Chapter 20 Software Development Security", \
          "desc"     : "Chapter 20 Software Development Security", \
          "category" : "CISSP", \
          "url"      : "/study/2023-05-30-cissp-chapter20", \
          "date"     : "May 30, 2023" \
        }, \
       \
        { \
          "title"    : "再游冲绳@2023/05", \
          "desc"     : "再游冲绳@2023/05", \
          "category" : "沖縄Okinawa出張", \
          "url"      : "/travel/2023-05-27-%E5%86%8D%E6%B8%B8%E5%86%B2%E7%BB%B3at2023-05", \
          "date"     : "May 27, 2023" \
        }, \
       \
        { \
          "title"    : "天満宮&amp;東照宮@仙台", \
          "desc"     : "天満宮&amp;東照宮@仙台", \
          "category" : "仙台天満宮東照宮", \
          "url"      : "/travel/2023-05-26-%E5%A4%A9%E6%BA%80%E5%AE%AEand%E6%9D%B1%E7%85%A7%E5%AE%AEat%E4%BB%99%E5%8F%B0", \
          "date"     : "May 26, 2023" \
        }, \
       \
        { \
          "title"    : "修心養性", \
          "desc"     : "修心養性", \
          "category" : "修心養性上善若水", \
          "url"      : "/life/2023-05-14-%E4%BF%AE%E5%BF%83%E9%A4%8A%E6%80%A7", \
          "date"     : "May 14, 2023" \
        }, \
       \
        { \
          "title"    : "2023年黄金周自驾游 东日本走起", \
          "desc"     : "2023年黄金周自驾游 东日本走起", \
          "category" : "ドライブ東日本福島", \
          "url"      : "/travel/2023-05-05-2023%E5%B9%B4%E9%BB%84%E9%87%91%E5%91%A8%E8%87%AA%E9%A9%BE%E6%B8%B8%E4%B8%9C%E6%97%A5%E6%9C%AC%E8%B5%B0%E8%B5%B7", \
          "date"     : "May  5, 2023" \
        }, \
       \
        { \
          "title"    : "基本から学ぶテストプロセス管理」の読書筆記", \
          "desc"     : "基本から学ぶテストプロセス管理」の読書筆記", \
          "category" : "testtest processテストテストプロセス", \
          "url"      : "/books/2023-04-30-%E5%9F%BA%E6%9C%AC%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6%E3%83%86%E3%82%B9%E3%83%88%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E7%AE%A1%E7%90%86%E3%81%AE%E8%AA%AD%E6%9B%B8%E7%AD%86%E8%A8%98", \
          "date"     : "April 30, 2023" \
        }, \
       \
        { \
          "title"    : "About NFT", \
          "desc"     : "About NFT", \
          "category" : "NFT", \
          "url"      : "/study/2023-04-27-about-nft", \
          "date"     : "April 27, 2023" \
        }, \
       \
        { \
          "title"    : "PCI DSS v4.0読書筆記", \
          "desc"     : "PCI DSS v4.0読書筆記", \
          "category" : "pci-dss", \
          "url"      : "/security/2023-04-16-pcidssv4%E8%AA%AD%E6%9B%B8%E7%AD%86%E8%A8%98", \
          "date"     : "April 16, 2023" \
        }, \
       \
        { \
          "title"    : "イシューからはじめようの読書筆記", \
          "desc"     : "イシューからはじめようの読書筆記", \
          "category" : "issues", \
          "url"      : "/books/2023-04-16-issue%E3%81%8B%E3%82%89%E3%81%AF%E3%81%98%E3%82%81%E3%82%88%E3%81%86%E3%81%AE%E8%AA%AD%E6%9B%B8%E7%AD%86%E8%A8%98", \
          "date"     : "April 16, 2023" \
        }, \
       \
        { \
          "title"    : "画像生成AIのMidjourneyを試してみました", \
          "desc"     : "画像生成AIのMidjourneyを試してみました", \
          "category" : "Midjourney生成AI", \
          "url"      : "/it/2023-03-26-%E7%94%BB%E5%83%8F%E7%94%9F%E6%88%90ai%E3%81%AEmidjourney", \
          "date"     : "March 26, 2023" \
        }, \
       \
        { \
          "title"    : "OpenAIのDALL-E2を試してみました", \
          "desc"     : "OpenAIのDALL-E2を試してみました", \
          "category" : "OpenAIDALL-E2", \
          "url"      : "/it/2023-03-26-openai%E3%81%AEdall-e2%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%81%BE%E3%81%97%E3%81%9F", \
          "date"     : "March 26, 2023" \
        }, \
       \
        { \
          "title"    : "macOS Usage Tips", \
          "desc"     : "macOS Usage Tips", \
          "category" : "macOSTips", \
          "url"      : "/it/2023-03-21-macos-usage-tips", \
          "date"     : "March 21, 2023" \
        }, \
       \
        { \
          "title"    : "梅と桃のお花見", \
          "desc"     : "梅と桃のお花見", \
          "category" : "花見cherry blossom viewinghanami", \
          "url"      : "/life/2023-03-18-%E6%A2%85%E3%81%A8%E6%A1%83%E3%81%AE%E3%81%8A%E8%8A%B1%E8%A6%8B", \
          "date"     : "March 18, 2023" \
        }, \
       \
        { \
          "title"    : "Finance Study", \
          "desc"     : "Finance Study", \
          "category" : "financefiscniscfsa", \
          "url"      : "/study/2023-03-15-finance-study", \
          "date"     : "March 15, 2023" \
        }, \
       \
        { \
          "title"    : "GmailでPGPを使ったメール暗号化の検証", \
          "desc"     : "GmailでPGPを使ったメール暗号化の検証", \
          "category" : "GmailPGP", \
          "url"      : "/it/2023-03-07-gmail%E3%81%A7PGP%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%83%A1%E3%83%BC%E3%83%AB%E6%9A%97%E5%8F%B7%E5%8C%96%E3%81%AE%E6%A4%9C%E8%A8%BC", \
          "date"     : "March  7, 2023" \
        }, \
       \
        { \
          "title"    : "Chapter 19 Investigations and Ethics", \
          "desc"     : "Chapter 19 Investigations and Ethics", \
          "category" : "CISSP", \
          "url"      : "/study/2023-03-02-cissp-chapter19", \
          "date"     : "March  2, 2023" \
        }, \
       \
        { \
          "title"    : "Penetration Testing Study", \
          "desc"     : "Penetration Testing Study", \
          "category" : "Penetration Test", \
          "url"      : "/security/2023-03-02-penetration-testing-study", \
          "date"     : "March  2, 2023" \
        }, \
       \
        { \
          "title"    : "Flutterを使ってみた", \
          "desc"     : "Flutterを使ってみた", \
          "category" : "Flutter", \
          "url"      : "/study/2023-02-21-Flutter%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F", \
          "date"     : "February 21, 2023" \
        }, \
       \
        { \
          "title"    : "ChatGPTをいろいろ使ってみる", \
          "desc"     : "ChatGPTをいろいろ使ってみる", \
          "category" : "ChatGPT生成AI", \
          "url"      : "/study/2023-02-16-ChatGPT%E3%82%92%E3%81%8A%E8%A9%A6%E3%81%97", \
          "date"     : "February 16, 2023" \
        }, \
       \
        { \
          "title"    : "Node.js NPM Study", \
          "desc"     : "Node.js NPM Study", \
          "category" : "node.jsnpm", \
          "url"      : "/it/2023-02-11-nodejs-npm-study", \
          "date"     : "February 11, 2023" \
        }, \
       \
        { \
          "title"    : "在Mac本地使用Screwdriver.cd验证job build", \
          "desc"     : "在Mac本地使用Screwdriver.cd验证job build", \
          "category" : "screwdriver.cdjob build", \
          "url"      : "/it/2023-02-10-mac%E6%9C%AC%E5%9C%B0%E4%BD%BF%E7%94%A8screwdriver%E9%AA%8C%E8%AF%81", \
          "date"     : "February 10, 2023" \
        }, \
       \
        { \
          "title"    : "Lots of TOP10 of 2022", \
          "desc"     : "Lots of TOP10 of 2022", \
          "category" : "TOP10", \
          "url"      : "/technology/2023-01-31-lotsoftip10of2022", \
          "date"     : "January 31, 2023" \
        }, \
       \
        { \
          "title"    : "2023年お正月、東京・浜離宮庭園で放鷹術を見学", \
          "desc"     : "2023年お正月、東京・浜離宮庭園で放鷹術を見学", \
          "category" : "Eagle鷹浜離宮", \
          "url"      : "/life/2023-01-03-2023%E5%B9%B4%E3%81%8A%E6%AD%A3%E6%9C%88%E6%9D%B1%E4%BA%AC%E6%B5%9C%E9%9B%A2%E5%AE%AE%E5%BA%AD%E5%9C%92%E3%81%A7%E6%94%BE%E9%B7%B9%E8%A1%93%E3%82%92%E8%A6%8B%E5%AD%A6", \
          "date"     : "January  3, 2023" \
        }, \
       \
        { \
          "title"    : "WordPress的用法TIPS", \
          "desc"     : "WordPress的用法TIPS", \
          "category" : "WordPress", \
          "url"      : "/it/2023-01-01-WordPress%E7%9A%84%E7%94%A8%E6%B3%95TIPS", \
          "date"     : "January  1, 2023" \
        }, \
       \
        { \
          "title"    : "JekyllでGitHub Pagesにサイト公開を試す", \
          "desc"     : "JekyllでGitHub Pagesにサイト公開を試す", \
          "category" : "JekyllGithub Pages", \
          "url"      : "/it/2022-12-29-Jekyll%E3%81%A7GitHubPages%E3%81%AB%E3%82%B5%E3%82%A4%E3%83%88%E5%85%AC%E9%96%8B", \
          "date"     : "December 29, 2022" \
        }, \
       \
        { \
          "title"    : "我家猫的新小伙伴（トモネコ）", \
          "desc"     : "我家猫的新小伙伴（トモネコ）", \
          "category" : "cat", \
          "url"      : "/cat/2022-12-25-%E6%88%91%E5%AE%B6%E7%8C%AB%E7%9A%84%E6%96%B0%E5%B0%8F%E4%BC%99%E4%BC%B4", \
          "date"     : "December 25, 2022" \
        }, \
       \
        { \
          "title"    : "macOSのApache httpdの自動再起動設定", \
          "desc"     : "macOSのApache httpdの自動再起動設定", \
          "category" : "macOSapachehttpd", \
          "url"      : "/it/2022-12-13-macOS%E3%81%AEApache%E3%81%AEhttpd%E3%81%AE%E8%87%AA%E5%8B%95%E5%86%8D%E8%B5%B7%E5%8B%95%E8%A8%AD%E5%AE%9A", \
          "date"     : "December 13, 2022" \
        }, \
       \
        { \
          "title"    : "大学入学共通テストまとめ", \
          "desc"     : "大学入学共通テストまとめ", \
          "category" : "大学入試共通テスト", \
          "url"      : "/study/2022-12-07-%E5%A4%A7%E5%AD%A6%E5%85%A5%E5%AD%A6%E5%85%B1%E9%80%9A%E3%83%86%E3%82%B9%E3%83%88%E3%81%BE%E3%81%A8%E3%82%81", \
          "date"     : "December  7, 2022" \
        }, \
       \
        { \
          "title"    : "About OpenSSF", \
          "desc"     : "About OpenSSF", \
          "category" : "OpenSSF", \
          "url"      : "/security/2022-11-21-aboutopenssf", \
          "date"     : "November 21, 2022" \
        }, \
       \
        { \
          "title"    : "日本で定年退職後に変わることメモ", \
          "desc"     : "日本で定年退職後に変わることメモ", \
          "category" : "retire定年リタイヤ", \
          "url"      : "/life/2022-11-21-%E6%97%A5%E6%9C%AC%E3%81%A7%E5%AE%9A%E5%B9%B4%E9%80%80%E8%81%B7%E5%BE%8C%E3%81%AB%E5%A4%89%E3%82%8F%E3%82%8B%E3%81%93%E3%81%A8%E3%83%A1%E3%83%A2", \
          "date"     : "November 21, 2022" \
        }, \
       \
        { \
          "title"    : "DXレポートの読後感", \
          "desc"     : "DXレポートの読後感", \
          "category" : "DX", \
          "url"      : "/it/2022-11-19-DX%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E3%81%AE%E8%AA%AD%E5%BE%8C%E6%84%9F", \
          "date"     : "November 19, 2022" \
        }, \
       \
        { \
          "title"    : "macOSのapache2にSSLの自己証明書を導入", \
          "desc"     : "macOSのapache2にSSLの自己証明書を導入", \
          "category" : "macOSapache2SSL証明書", \
          "url"      : "/it/2022-11-17-macOS%E3%81%AEpache2%E3%81%ABSSL%E3%81%AE%E8%87%AA%E5%B7%B1%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%82%92%E5%B0%8E%E5%85%A5", \
          "date"     : "November 17, 2022" \
        }, \
       \
        { \
          "title"    : "Chapter 18 Disaster Recovery Planning", \
          "desc"     : "Chapter 18 Disaster Recovery Planning", \
          "category" : "CISSP", \
          "url"      : "/study/2022-11-17-cissp-chapter18", \
          "date"     : "November 17, 2022" \
        }, \
       \
        { \
          "title"    : "BBQ@水元公園", \
          "desc"     : "BBQ@水元公園", \
          "category" : "BBQ水元公園", \
          "url"      : "/life/2022-11-13-BBQat%E6%B0%B4%E5%85%83%E5%85%AC%E5%9C%92", \
          "date"     : "November 13, 2022" \
        }, \
       \
        { \
          "title"    : "Backup EBS to S3 by AMI", \
          "desc"     : "Backup EBS to S3 by AMI", \
          "category" : "EBSS3AMI", \
          "url"      : "/it/2022-11-06-BackupEBStoS3byAMI", \
          "date"     : "November  6, 2022" \
        }, \
       \
        { \
          "title"    : "CloudFront+EC2でSSL通信させる", \
          "desc"     : "CloudFront+EC2でSSL通信させる", \
          "category" : "AWSCloudFrontSSL", \
          "url"      : "/it/2022-11-04-CloudFront%E3%81%A7SSL%E9%80%9A%E4%BF%A1%E3%81%95%E3%81%9B%E3%82%8B", \
          "date"     : "November  4, 2022" \
        }, \
       \
        { \
          "title"    : "AWS EC2 のディスク使用量100%の解決方法", \
          "desc"     : "AWS EC2 のディスク使用量100%の解決方法", \
          "category" : "AWSEC2HDD容量", \
          "url"      : "/it/2022-10-17-EC2%E3%81%AE%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E4%BD%BF%E7%94%A8%E9%87%8F%E3%81%AE%E8%A7%A3%E6%B1%BA%E6%96%B9%E6%B3%95", \
          "date"     : "October 17, 2022" \
        }, \
       \
        { \
          "title"    : "Chapter 17 Preventing and Responding to Incidents", \
          "desc"     : "Chapter 17 Preventing and Responding to Incidents", \
          "category" : "CISSP", \
          "url"      : "/study/2022-10-04-cissp_chapter17", \
          "date"     : "October  4, 2022" \
        }, \
       \
        { \
          "title"    : "About TOEFL iBT TEST", \
          "desc"     : "About TOEFL iBT TEST", \
          "category" : "toefl iBT Test", \
          "url"      : "/study/2022-09-26-about-toefl-ibt-test", \
          "date"     : "September 26, 2022" \
        }, \
       \
        { \
          "title"    : "Global Famous Cars", \
          "desc"     : "Global Famous Cars", \
          "category" : "car", \
          "url"      : "/other/2022-09-25-global-famous-cars", \
          "date"     : "September 25, 2022" \
        }, \
       \
        { \
          "title"    : "福岡市出張", \
          "desc"     : "福岡市出張", \
          "category" : "福岡市出張", \
          "url"      : "/travel/2022-09-18-%E7%A6%8F%E5%B2%A1%E5%B8%82%E5%87%BA%E5%BC%B5", \
          "date"     : "September 18, 2022" \
        }, \
       \
        { \
          "title"    : "Chapter 16 Managing Security Operations", \
          "desc"     : "Chapter 16 Managing Security Operations", \
          "category" : "CISSP", \
          "url"      : "/study/2022-09-18-cissp_chapter16", \
          "date"     : "September 18, 2022" \
        }, \
       \
        { \
          "title"    : "Chapter 15 Security Assessment and Testing", \
          "desc"     : "Chapter 15 Security Assessment and Testing", \
          "category" : "CISSP", \
          "url"      : "/study/2022-08-25-cissp_chapter15", \
          "date"     : "August 25, 2022" \
        }, \
       \
        { \
          "title"    : "TAKAGI製の水栓修理DIY", \
          "desc"     : "TAKAGI製の水栓修理DIY", \
          "category" : "DIY水栓修理", \
          "url"      : "/life/2022-08-07-TAKAGI%E8%A3%BD%E3%81%AE%E6%B0%B4%E6%A0%93%E4%BF%AE%E7%90%86DIY", \
          "date"     : "August  7, 2022" \
        }, \
       \
        { \
          "title"    : "About SSO (Single Sign On)", \
          "desc"     : "About SSO (Single Sign On)", \
          "category" : "SSO", \
          "url"      : "/security/2022-06-26-about-sso", \
          "date"     : "June 26, 2022" \
        }, \
       \
        { \
          "title"    : "Chapter 14 Controlling and Monitoring Access", \
          "desc"     : "Chapter 14 Controlling and Monitoring Access", \
          "category" : "CISSP", \
          "url"      : "/study/2022-06-23-cissp_chapter14", \
          "date"     : "June 23, 2022" \
        }, \
       \
        { \
          "title"    : "冲绳到此一游", \
          "desc"     : "冲绳到此一游", \
          "category" : "沖縄Okinawa", \
          "url"      : "/travel/2022-06-18-%E5%86%B2%E7%BB%B3%E5%88%B0%E6%AD%A4%E4%B8%80%E6%B8%B8", \
          "date"     : "June 18, 2022" \
        }, \
       \
        { \
          "title"    : "食&amp;夜@仙台", \
          "desc"     : "食&amp;夜@仙台", \
          "category" : "牛たんGyutan出張", \
          "url"      : "/gourmet/2022-05-30-%E9%A3%9Fand%E5%A4%9Cat%E4%BB%99%E5%8F%B0", \
          "date"     : "May 30, 2022" \
        }, \
       \
        { \
          "title"    : "寻踪周树人&amp;藤野先生@仙台", \
          "desc"     : "寻踪周树人&amp;藤野先生@仙台", \
          "category" : "鲁迅周树人藤野先生sendai仙台", \
          "url"      : "/travel/2022-05-20-%E5%AF%BB%E8%B8%AA%E5%91%A8%E6%A0%91%E4%BA%BAand%E8%97%A4%E9%87%8E%E5%85%88%E7%94%9Fat%E4%BB%99%E5%8F%B0", \
          "date"     : "May 20, 2022" \
        }, \
       \
        { \
          "title"    : "Chapter 13 Managing Identity and Authentication", \
          "desc"     : "Chapter 13 Managing Identity and Authentication", \
          "category" : "CISSP", \
          "url"      : "/study/2022-05-09-cissp_chapter13", \
          "date"     : "May  9, 2022" \
        }, \
       \
        { \
          "title"    : "Blog環境改造記", \
          "desc"     : "Blog環境改造記", \
          "category" : "blogwordpress", \
          "url"      : "/it/2022-05-09-blog%E7%92%B0%E5%A2%83%E6%94%B9%E9%80%A0%E8%A8%98", \
          "date"     : "May  9, 2022" \
        }, \
       \
        { \
          "title"    : "流山之行", \
          "desc"     : "流山之行", \
          "category" : "流山Spring温泉", \
          "url"      : "/travel/2022-05-06-%E6%B5%81%E5%B1%B1%E4%B9%8B%E8%A1%8C", \
          "date"     : "May  6, 2022" \
        }, \
       \
        { \
          "title"    : "東京-三越前散策", \
          "desc"     : "東京-三越前散策", \
          "category" : "WalkMitsukoshi", \
          "url"      : "/other/2022-05-05-%E6%9D%B1%E4%BA%AC%E4%B8%89%E8%B6%8A%E5%89%8D%E6%95%A3%E7%AD%96", \
          "date"     : "May  5, 2022" \
        }, \
       \
        { \
          "title"    : "🎏市川市的鲤鱼旗🎏", \
          "desc"     : "🎏市川市的鲤鱼旗🎏", \
          "category" : "鯉のぼりKoinobori", \
          "url"      : "/life/2022-05-05-%E5%B8%82%E5%B7%9D%E5%B8%82%E7%9A%84%E9%B2%A4%E9%B1%BC%E6%97%97", \
          "date"     : "May  5, 2022" \
        }, \
       \
        { \
          "title"    : "EC2からSES経由でメール送信する", \
          "desc"     : "EC2からSES経由でメール送信する", \
          "category" : "AWSEC2SES", \
          "url"      : "/it/2022-05-05-EC2%E3%81%8B%E3%82%89SES%E7%B5%8C%E7%94%B1%E3%81%A7%E3%83%A1%E3%83%BC%E3%83%AB%E9%80%81%E4%BF%A1%E3%81%99%E3%82%8B", \
          "date"     : "May  5, 2022" \
        }, \
       \
        { \
          "title"    : "美貓魚", \
          "desc"     : "美貓魚", \
          "category" : "catdress-upfish", \
          "url"      : "/cat/2022-05-05-%E7%BE%8E%E8%B2%93%E9%AD%9A", \
          "date"     : "May  5, 2022" \
        }, \
       \
        { \
          "title"    : "海底撈火鍋上野店", \
          "desc"     : "海底撈火鍋上野店", \
          "category" : "海底捞", \
          "url"      : "/gourmet/2022-05-03-%E6%B5%B7%E5%BA%95%E6%92%88%E7%81%AB%E9%8D%8B%E4%B8%8A%E9%87%8E%E5%BA%97", \
          "date"     : "May  3, 2022" \
        }, \
       \
        { \
          "title"    : "アンデルセン公園", \
          "desc"     : "アンデルセン公園", \
          "category" : "Andersen Park安徒生公园", \
          "url"      : "/travel/2022-05-02-%E3%82%A2%E3%83%B3%E3%83%87%E3%83%AB%E3%82%BB%E3%83%B3%E5%85%AC%E5%9C%92", \
          "date"     : "May  2, 2022" \
        }, \
       \
        { \
          "title"    : "今日の晩ごはん", \
          "desc"     : "今日の晩ごはん", \
          "category" : "Shushi寿司すし", \
          "url"      : "/gourmet/2022-05-01-%E4%BB%8A%E6%97%A5%E3%81%AE%E6%99%A9%E3%81%94%E3%81%AF%E3%82%93", \
          "date"     : "May  1, 2022" \
        }, \
       \
        { \
          "title"    : "Sample blog post to learn markdown tips", \
          "desc"     : "Sample blog post to learn markdown tips", \
          "category" : "test", \
          "url"      : "/2020-02-28-sample-markdown", \
          "date"     : "February 28, 2020" \
        }, \
       \
        { \
          "title"    : "Flake it till you make it", \
          "desc"     : "Flake it till you make it", \
          "category" : "bookstest", \
          "url"      : "/2020-02-26-flake-it-till-you-make-it", \
          "date"     : "February 26, 2020" \
        }, \
       \
       \
        { \
          "title"    : "About me", \
          "desc"     : "About me", \
          "category" : "page", \
          "url"      : "/aboutme", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "desc"     : "", \
          "category" : "page", \
          "url"      : "/category/books", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "desc"     : "", \
          "category" : "page", \
          "url"      : "/category/cat", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "desc"     : "", \
          "category" : "page", \
          "url"      : "/category/gourmet", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "IT技術者的BLOG", \
          "desc"     : "IT技術者的BLOG", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "desc"     : "", \
          "category" : "page", \
          "url"      : "/category/it", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "desc"     : "", \
          "category" : "page", \
          "url"      : "/category/life", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "desc"     : "", \
          "category" : "page", \
          "url"      : "/category/other", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "desc"     : "", \
          "category" : "page", \
          "url"      : "/category/security", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "desc"     : "", \
          "category" : "page", \
          "url"      : "/category/study", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Tag Index", \
          "desc"     : "Tag Index", \
          "category" : "page", \
          "url"      : "/tags", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "desc"     : "", \
          "category" : "page", \
          "url"      : "/category/travel", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "IT技術者的BLOG", \
          "desc"     : "IT技術者的BLOG", \
          "category" : "page", \
          "url"      : "/page2/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "IT技術者的BLOG", \
          "desc"     : "IT技術者的BLOG", \
          "category" : "page", \
          "url"      : "/page3/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "IT技術者的BLOG", \
          "desc"     : "IT技術者的BLOG", \
          "category" : "page", \
          "url"      : "/page4/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "IT技術者的BLOG", \
          "desc"     : "IT技術者的BLOG", \
          "category" : "page", \
          "url"      : "/page5/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "IT技術者的BLOG", \
          "desc"     : "IT技術者的BLOG", \
          "category" : "page", \
          "url"      : "/page6/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "IT技術者的BLOG", \
          "desc"     : "IT技術者的BLOG", \
          "category" : "page", \
          "url"      : "/page7/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "IT技術者的BLOG", \
          "desc"     : "IT技術者的BLOG", \
          "category" : "page", \
          "url"      : "/page8/", \
          "date"     : "January 1, 1970" \
        } \
       \
    ]';
    searchjson = JSON.parse(searchjson);

    var sjs = SimpleJekyllSearch({
      searchInput: document.getElementById('nav-search-input'),
      resultsContainer: document.getElementById('search-results-container'),
      json: searchjson
    });
  </script>
</div>





  <!-- TODO this file has become a mess, refactor it -->






  <div id="header-big-imgs" data-num-img=3
    
    
    
      
      data-img-src-1="http://localhost:4000/assets/img/cover/security1.jpg"
    
    
    
    
    
      
      data-img-src-2="http://localhost:4000/assets/img/cover/security2.jpg"
    
    
    
    
    
      
      data-img-src-3="http://localhost:4000/assets/img/cover/security3.jpg"
    
    
    
  ></div>


<header class="header-section has-img">

<div class="big-img intro-header">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>OWASP API Security Top 10 Study</h1>
          

          
            <span class="post-meta">Posted on June 20, 2023</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
  <span class='img-desc'></span>
</div>

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>OWASP API Security Top 10 Study</h1>
          

          
            <span class="post-meta">Posted on June 20, 2023</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>



</header>




<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <h1 id="summary">Summary</h1>
<p>This is my studying note of OWASP API Security Project.</p>
<ul>
  <li>The page of <a href="https://owasp.org/www-project-api-security/">OWASP API Security Project</a>.</li>
  <li>The other <a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0x03-introduction.md">OWASP Top 10 Series</a>.</li>
</ul>

<p><img src="https://i.imgur.com/slPpf5D.png" alt="file" /></p>

<h1 id="editions">Editions</h1>
<p>There are two ediitons of API Security Top 10, which are 2019 and 2023.</p>
<ul>
  <li><a href="https://github.com/OWASP/API-Security/tree/master/editions">Editions</a>
    <ul>
      <li><a href="https://github.com/OWASP/API-Security/blob/master/editions/2019/en/0x11-t10.md">2019</a></li>
      <li><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0x11-t10.md">2023</a></li>
    </ul>
  </li>
</ul>

<p><img src="https://i.imgur.com/WhMfzv8.png" alt="file" />
ref : https://www.anquanke.com/post/id/288466</p>

<h1 id="api-security-top-10--2023">API Security Top 10 – 2023</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Risk</th>
      <th style="text-align: left">Description</th>
      <th style="text-align: left">要約</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa1-broken-object-level-authorization.md">API1 - Broken Object Level Authorization</a>&lt;/br&gt;&lt;/br&gt;BOLA&lt;/br&gt;&lt;/br&gt;对象级别授权失效&lt;/br&gt;&lt;/br&gt;オブジェクト・レベル認証の失敗</td>
      <td style="text-align: left">APIs tend to expose endpoints that handle object identifiers, creating a wide attack surface of Object Level Access Control issues. Object level authorization checks should be considered in every function that accesses a data source using an ID from the user.</td>
      <td style="text-align: left">APIはオブジェクト識別子を扱うエンドポイントを公開し、これによりアクセス制御の問題が生じやすい。ユーザからのIDを使ってデータにアクセスする全ての機能において、オブジェクトレベルでの認証チェックが必要である。</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://owasp.org/API-Security/editions/2023/en/0xa2-broken-authentication/">API2 - Broken Authentication</a>&lt;/br&gt;&lt;/br&gt;BA&lt;/br&gt;&lt;/br&gt;身份认证失效&lt;/br&gt;&lt;/br&gt;認証の不備</td>
      <td style="text-align: left">Authentication mechanisms are often implemented incorrectly, allowing attackers to compromise authentication tokens or to exploit implementation flaws to assume other user’s identities temporarily or permanently. Compromising a system’s ability to identify the client/user, compromises API security overall.</td>
      <td style="text-align: left">認証メカニズムの誤った実装により、攻撃者が認証トークンを侵害するか、または実装の欠陥を悪用して他人の身元を詐称する可能性がある。システムのユーザー識別能力が損なわれると、APIの全体的なセキュリティが低下する。</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa3-broken-object-property-level-authorization.md">API3 - Broken Object Property Level Authorization</a>&lt;/br&gt;&lt;/br&gt;BOPLA&lt;/br&gt;&lt;/br&gt;对象属性级别授权失效&lt;/br&gt;&lt;/br&gt;オブジェクトプロパティレベルの認可不備</td>
      <td style="text-align: left">This category combines API3:2019 Excessive Data Exposure and API6:2019 - Mass Assignment, focusing on the root cause: the lack of or improper authorization validation at the object property level. This leads to information exposure or manipulation by unauthorized parties.</td>
      <td style="text-align: left">「API3:2019 過度なデータ公開」と「API6:2019 - 大量割り当て」を組み合わせたもので、問題の根源であるオブジェクトのプロパティレベルにおける認証検証の欠如または不適切さに焦点を当てている。このことが原因で、情報が不正な第三者に公開されたり、操作されたりすることがある</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa4-unrestricted-resource-consumption.md">API4 - Unrestricted Resource Consumption</a>&lt;/br&gt;&lt;/br&gt;URC&lt;/br&gt;&lt;/br&gt;资源消耗无限制&lt;/br&gt;&lt;/br&gt;制限なきリソース消費</td>
      <td style="text-align: left">Satisfying API requests requires resources such as network bandwidth, CPU, memory, and storage. Other resources such as emails/SMS/phone calls or biometrics validation are made available by service providers via API integrations, and paid for per request. Successful attacks can lead to Denial of Service or an increase of operational costs.</td>
      <td style="text-align: left">APIリクエストの処理には各種リソースが必要で、その一部はリクエスト毎に課金される。攻撃が成功すると、サービス停止や運用コストの増加を引き起こす可能性がある。</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa5-broken-function-level-authorization.md">API5 - Broken Function Level Authorization</a>&lt;/br&gt;&lt;/br&gt;BFLA&lt;/br&gt;&lt;/br&gt;功能级授权失效&lt;/br&gt;&lt;/br&gt;関数レベルの認可不備</td>
      <td style="text-align: left">Complex access control policies with different hierarchies, groups, and roles, and an unclear separation between administrative and regular functions, tend to lead to authorization flaws. By exploiting these issues, attackers can gain access to other users’ resources and/or administrative functions.</td>
      <td style="text-align: left">異なる階層、グループ、役割を持つ複雑なアクセス制御ポリシーと、管理機能と一般機能の間の不明確な分離は、認可の欠陥を引き起こす傾向がある。これらの問題を攻撃者が悪用すると、他のユーザーのリソースや管理機能にアクセスできるようになる。</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa6-unrestricted-access-to-sensitive-business-flows.md">API6 - Unrestricted Access to Sensitive Business Flows</a>&lt;/br&gt;&lt;/br&gt;UAtSBF&lt;/br&gt;&lt;/br&gt;对敏感业务流程的无限制访问&lt;/br&gt;&lt;/br&gt;敏感な業務フローへの無制限アクセス</td>
      <td style="text-align: left">APIs vulnerable to this risk expose a business flow - such as buying a ticket, or posting a comment - without compensating for how the functionality could harm the business if used excessively in an automated manner. This doesn’t necessarily come from implementation bugs.</td>
      <td style="text-align: left">このリスクに対して脆弱なAPIは、自動化による過度な使用がビジネスに損害をもたらす可能性を考慮せず、ビジネスフローを公開する。これは必ずしも実装のバグから起こるわけではない。</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa7-server-side-request-forgery.md">API7 - Server Side Request Forgery</a>&lt;/br&gt;&lt;/br&gt;SSRF&lt;/br&gt;&lt;/br&gt;服务端请求伪造&lt;/br&gt;&lt;/br&gt;サーバーサイドリクエストフォージェリ</td>
      <td style="text-align: left">Server-Side Request Forgery (SSRF) flaws can occur when an API is fetching a remote resource without validating the user-supplied URI. This enables an attacker to coerce the application to send a crafted request to an unexpected destination, even when protected by a firewall or a VPN.</td>
      <td style="text-align: left">APIがユーザーから提供されたURIを検証せずにリモートリソースを取得する場合、SSRFの脆弱性が生じる可能性がある。これにより、攻撃者はファイアウォールやVPNの保護下にある状態でも、アプリケーションが意図しない宛先に対して操作を行うことができる。</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa8-security-misconfiguration.md">API8 - Security Misconfiguration</a>&lt;/br&gt;&lt;/br&gt;SM&lt;/br&gt;&lt;/br&gt;安全配置错误&lt;/br&gt;&lt;/br&gt;セキュリティの設定ミス</td>
      <td style="text-align: left">APIs and the systems supporting them typically contain complex configurations, meant to make the APIs more customizable. Software and DevOps engineers can miss these configurations, or don’t follow security best practices when it comes to configuration, opening the door for different types of attacks.</td>
      <td style="text-align: left">APIとそれをサポートするシステムは、一般的に複雑な構成を持ち、APIをよりカスタマイズ可能にするためのものである。ソフトウェアやDevOpsエンジニアはこれらの構成を見逃すことがあるか、または構成に関するセキュリティのベストプラクティスを遵守しないことがあり、それによってさまざまな種類の攻撃の可能性が生じる。</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xa9-improper-inventory-management.md">API9 - Improper Inventory Management</a>&lt;/br&gt;&lt;/br&gt;IIM&lt;/br&gt;&lt;/br&gt;存量资产管理不当&lt;/br&gt;&lt;/br&gt;適切でない在庫管理</td>
      <td style="text-align: left">APIs tend to expose more endpoints than traditional web applications, making proper and updated documentation highly important. A proper inventory of hosts and deployed API versions also are important to mitigate issues such as deprecated API versions and exposed debug endpoints.</td>
      <td style="text-align: left">APIは通常、従来のWebアプリケーションよりも多くのエンドポイントを公開しており、正確かつ最新のドキュメントが重要である。また、適切なホストと展開されたAPIバージョンの管理も重要であり、非推奨のAPIバージョンやデバッグエンドポイントの問題を防ぐのに役立つ。</td>
    </tr>
    <tr>
      <td style="text-align: left"><a href="https://github.com/OWASP/API-Security/blob/master/editions/2023/en/0xaa-unsafe-consumption-of-apis.md">API10 - Unsafe Consumption of APIs</a>&lt;/br&gt;&lt;/br&gt;UCoA&lt;/br&gt;&lt;/br&gt;API的不安全使用&lt;/br&gt;&lt;/br&gt;APIの危険な利用</td>
      <td style="text-align: left">Developers tend to trust data received from third-party APIs more than user input, and so tend to adopt weaker security standards. In order to compromise APIs, attackers go after integrated third-party services instead of trying to compromise the target API directly.</td>
      <td style="text-align: left">開発者は、第三者APIから受け取るデータをユーザーの入力よりも信頼し、そのために弱いセキュリティ基準を採用することがある。APIを侵害するために、攻撃者は直接的に対象のAPIを攻撃するのではなく、統合された第三者サービスを標的にすることもある。</td>
    </tr>
  </tbody>
</table>

<h1 id="api-security-risks">API Security Risks</h1>
<h2 id="common共通リスク">Common（共通リスク）</h2>
<p>|Threat Agents|Business Impacts|
|:-|:-|
|API Specific|Business Specific|</p>

<h2 id="specific特定リスク">Specific（特定リスク）</h2>
<p>|#|Risk|Exploitability|Prevalence|Detectability|Technical Impacts|
|:-|:-|:-|:-|:-|:-|
|API1|Broken Object Level Authorization|Easy&lt;/br&gt;3|Widespread&lt;/br&gt;3|Easy&lt;/br&gt;3|Moderate&lt;/br&gt;2|
|API2|Broken Authentication|Easy&lt;/br&gt;3|Common&lt;/br&gt;2|Easy&lt;/br&gt;3|Severe &lt;/br&gt;3|
|API3|Broken Object Property Level Authorization|Easy&lt;/br&gt;3|Common&lt;/br&gt;2|Easy&lt;/br&gt;3|Moderate  &lt;/br&gt;2|
|API4|Unrestricted Resource Consumption|Average &lt;/br&gt;2|Widespread &lt;/br&gt;3|Easy&lt;/br&gt;3|Severe   &lt;/br&gt;3|
|API5|Broken Function Level Authorization|Easy &lt;/br&gt;3|Common &lt;/br&gt;2|Easy&lt;/br&gt;3|Severe   &lt;/br&gt;3|
|API6|Unrestricted Access to Sensitive Business Flows|Easy &lt;/br&gt;3|Widespread &lt;/br&gt;3|Average &lt;/br&gt;2|Moderate&lt;/br&gt;2|
|API7|Server Side Request Forgery|Easy &lt;/br&gt;3|Common&lt;/br&gt;2|Easy &lt;/br&gt;3|Moderate&lt;/br&gt;2|
|API8|Security Misconfiguration|Easy &lt;/br&gt;3|Widespread&lt;/br&gt;3|Easy &lt;/br&gt;3|Severe&lt;/br&gt;3|
|API9|Improper Inventory Management|Easy &lt;/br&gt;3|Widespread&lt;/br&gt;3|Average&lt;/br&gt;2|Moderate&lt;/br&gt;2|
|API10|Unsafe Consumption of APIs|Easy &lt;/br&gt;3|Common&lt;/br&gt;2|Average&lt;/br&gt;2|Severe&lt;/br&gt;3|</p>

<h1 id="attacks--preventive-measures">Attacks &amp; Preventive Measures</h1>
<p>以下の疑似攻撃コードはイメージ的なものであり、かつ一部のコードを省略している可能性があるので、くれぐれも悪用しないよう自己責任でお願いします。</p>
<h2 id="api1-bolabroken-object-level-authorization">API1 BOLA（Broken Object Level Authorization）</h2>
<h3 id="attack-example">Attack Example</h3>
<p>以下の<code class="language-plaintext highlighter-rouge">JavaScript</code>コードは任意のshopnameの売上データを取得できうイメージを示している。</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 攻撃者がショップ名を特定し、リクエストを送信して売上データにアクセスする例</span>
<span class="c1">// 攻撃対象のショップ名を指定します</span>
<span class="kd">const</span> <span class="nx">targetShop</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">example-shop</span><span class="dl">'</span><span class="p">;</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">sendRequest</span><span class="p">(</span><span class="nx">shopName</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`https://example.com/shops/</span><span class="p">${</span><span class="nx">shopName</span><span class="p">}</span><span class="s2">/revenue_data.json`</span><span class="p">;</span>

    <span class="c1">// リクエストを送信し、売上データを取得します</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">sendRequest</span><span class="p">(</span><span class="nx">targetShop</span><span class="p">);</span>
</code></pre></div></div>
<h3 id="preventive-measures">Preventive Measures</h3>
<ul>
  <li>ユーザーポリシーや階層に依存する適切な認可メカニズムを実装。</li>
  <li>ログインユーザーが要求されたアクションを実行権限を持っているか、DBのレコードにアクセスするためのクライアントからの入力を使用するすべての関数で認可メカニズムを使用。</li>
  <li>レコードのIDにはランダムかつ予測不可能な値としてGUID（Globally Unique Identifier）を使用。</li>
  <li>認可メカニズムの脆弱性を評価するためのテストを作成。</li>
</ul>

<h2 id="api2-broken-authentication">API2 Broken Authentication</h2>
<h3 id="vulnerable-behaviors">Vulnerable Behaviors</h3>
<ul>
  <li>攻撃者が有効なユーザー名とパスワードのリストを使用して総当たり攻撃を行うクレデンシャルスタッフィングを許可している。</li>
  <li>キャプチャやアカウントロックアウトのメカニズムを提示せずに、攻撃者が同じユーザーアカウントに対して総当たり攻撃を行うことを許可している。</li>
  <li>弱いパスワードを許可している。</li>
  <li>認証トークンやパスワードなどの機密性の高い認証詳細をURLに送信している。</li>
  <li>ユーザーにパスワード確認を求めずに、メールアドレスの変更や現在のパスワードの変更などの機密性の高い操作を許可している。</li>
  <li>トークンの正当性を検証していない。</li>
  <li>未署名または弱く署名されたJWTトークン（{“alg”:”none”}）を受け入れている。</li>
  <li>JWTの有効期限を検証していない。</li>
  <li>平文、非暗号化、または弱いハッシュ化されたパスワードを使用している。</li>
  <li>弱い暗号化キーを使用している。</li>
</ul>

<p>さらに、マイクロサービスは以下のような脆弱性がある場合：</p>
<ul>
  <li>他のマイクロサービスが認証なしでアクセスできる。</li>
  <li>弱いまたは予測可能なトークンを使用して認証を強制している。</li>
</ul>

<h3 id="attack-example-1">Attack Example</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// サンプルユーザーの認証情報</span>
<span class="kd">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">password</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// 悪意のあるユーザーが攻撃対象のユーザー名とパスワードを入手した場合の攻撃コード</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">attack</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// 攻撃者が正当なユーザーのクレデンシャルを使用して認証をバイパスし、権限のあるリソースにアクセスします</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">https://example.com/admin_panel</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="na">Authorization</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bearer &lt;attacker_token&gt;</span><span class="dl">"</span> <span class="p">}</span>
    <span class="p">});</span>

    <span class="c1">// 攻撃者が得た機密情報や操作結果を利用します</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">機密情報を取得しました！</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">attack</span><span class="p">();</span>
</code></pre></div></div>
<h3 id="preventive-measures-1">Preventive Measures</h3>
<ul>
  <li>APIへの認証フローを理解し、可能なフローを確認する。見落としているフローがないか、エンジニアに確認。</li>
  <li>認証メカニズムについて学び、それがどのように使われるのか理解。<font color="red">OAuthは認証ではなく、APIキーも同様ではない</font>。</li>
  <li>認証、トークン生成、パスワードの保存において車輪の再発明を避ける。標準を使用。</li>
  <li>認証回復/PW忘れのエンドポイントは、ブルートフォース、レート制限、ロックアウト保護の観点でログインエンドポイントと同様に扱う。</li>
  <li>機密な操作には再認証を要求。</li>
  <li>OWASP Authentication Cheatsheetを使用。</li>
  <li>可能な場合は、多要素認証を実装。</li>
  <li>認証エンドポイントへのcredential staffing、辞書攻撃、ブルートフォース攻撃を緩和するための対策を実装。このメカニズムは、APIの通常のレート制限メカニズムよりも厳格であるべき。</li>
  <li>特定のユーザーに対するブルートフォース攻撃を防ぐために、アカウントロックアウト/キャプチャメカニズムを実装。弱いパスワードのチェックを実装。</li>
  <li>
    <font color="red">APIキーはユーザー認証に使用すべきではなく、APIクライアントの認証にのみ使用する</font>
    <p>。</p>
  </li>
</ul>

<h2 id="api3-broken-object-property-level-authorization">API3 Broken Object Property Level Authorization</h2>
<h3 id="vulnerable-behaviors-1">Vulnerable Behaviors</h3>
<ul>
  <li>APIのエンドポイントは、ユーザーが読むべきでないとされるオブジェクトのプロパティを公開している（以前は「過剰なデータ露出」と呼ばれていた）。</li>
  <li>APIのエンドポイントは、ユーザーがアクセスできないべきである敏感なオブジェクトのプロパティの値を変更、追加、または削除することを許可してる（以前は「マスアサインメント」と呼ばれていました）。</li>
</ul>

<h3 id="attack-example-2">Attack Example</h3>
<p>下記の擬似コードでは、攻撃者は__proto__プロパティを使用して、リソースに新しいプロパティ（isAdmin）を追加し、セキュリティ制約を回避して不正な操作を行うことを示している。</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// 攻撃対象のリソースID</span>
<span class="kd">const</span> <span class="nx">resourceId</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">12345</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// 攻撃ペイロード</span>
<span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">__proto__</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">isAdmin</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// リソースの更新リクエストを送信</span>
<span class="nx">axios</span><span class="p">.</span><span class="nx">patch</span><span class="p">(</span><span class="s2">`https://example.com/resources/</span><span class="p">${</span><span class="nx">resourceId</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</code></pre></div></div>
<h3 id="preventive-measures-2">Preventive Measures</h3>
<ul>
  <li>APIエンドポイントを使用してオブジェクトを公開する際には、公開するオブジェクトのプロパティにアクセス権があることを常に確認。</li>
  <li>to_json()やto_string()などの汎用的なメソッドの使用は避け、返す特定のオブジェクトプロパティを選択的に取得（<font color="red">cherry-pick</font>）。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Sample object with sensitive properties</span>
<span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">123456</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">John Doe</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">email</span><span class="p">:</span> <span class="dl">'</span><span class="s1">johndoe@example.com</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">password</span><span class="p">:</span> <span class="dl">'</span><span class="s1">secretpassword</span><span class="dl">'</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// Cherry-picking specific properties to return</span>
<span class="kd">const</span> <span class="nx">publicUser</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">id</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
  <span class="na">name</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
<span class="p">};</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">publicUser</span><span class="p">);</span>
<span class="c1">// Output: { id: '123456', name: 'John Doe' }</span>
</code></pre></div></div>
<ul>
  <li>クライアントの入力をコード変数や内部オブジェクト、オブジェクトプロパティに自動的にバインドする関数の使用を避ける（<font color="red">「Mass Assignment」</font>）。</li>
</ul>

<p>問題あるコード：</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// User model</span>
<span class="kd">class</span> <span class="nx">User</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">email</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">isAdmin</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// API endpoint to update a user's profile</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="dl">'</span><span class="s1">/users/:id</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">isAdmin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

  <span class="c1">// Update the user's profile</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">findUserById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

  <span class="c1">// Mass assignment without proper authorization checks</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>

  <span class="c1">// Save the updated user</span>
  <span class="nx">saveUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>

  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">User profile updated successfully</span><span class="dl">'</span> <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>
<p>問題ないコード：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// User model</span>
<span class="p">...</span><span class="nx">省略</span><span class="p">...</span>
<span class="c1">// API endpoint to update a user's profile</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="dl">'</span><span class="s1">/users/:id</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">email</span><span class="p">,</span> <span class="nx">isAdmin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

  <span class="c1">// Update the user's profile</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">findUserById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

  <span class="c1">// Only update the allowed properties</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">email</span><span class="p">)</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">email</span><span class="p">;</span>

  <span class="c1">// Perform proper authorization checks for isAdmin</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isAdmin</span> <span class="o">&amp;&amp;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">isAdmin</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">user</span><span class="p">.</span><span class="nx">isAdmin</span> <span class="o">=</span> <span class="nx">isAdmin</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Save the updated user</span>
  <span class="nx">saveUser</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>

  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">User profile updated successfully</span><span class="dl">'</span> <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>
<ul>
  <li>クライアントによって更新されるべきオブジェクトのプロパティにのみ変更を許可。</li>
  <li>付加的なセキュリティレイヤーとして、スキーマベースの応答検証メカニズムを実装。このメカニズムでは、すべてのAPIメソッドで返されるデータを定義し、強制する。</li>
  <li>エンドポイントのビジネス/機能要件に基づいて、返されるデータ構造を最小限に保つ。</li>
</ul>

<h2 id="api4-unrestricted-resource-consumption">API4 Unrestricted Resource Consumption</h2>
<h3 id="vulnerable-behaviors-2">Vulnerable Behaviors</h3>
<p>APIの脆弱性は、次のいずれかの制限が不足しているか、適切に設定されていない場合に生じる:</p>
<ul>
  <li>実行タイムアウト</li>
  <li>最大割り当て可能メモリ</li>
  <li>最大ファイルディスクリプタ数</li>
  <li>最大プロセス数</li>
  <li>最大アップロードファイルサイズ</li>
  <li>1つのAPIクライアントリクエストで実行する操作の数（例：GraphQLバッチング）</li>
  <li>1つのリクエスト-レスポンスで返されるページごとのレコード数</li>
  <li>3rd Partyサービスプロバイダの支出制限</li>
</ul>

<h3 id="attack-example-3">Attack Example</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">// Endpoint that performs a heavy computation</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/process</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Simulate a resource-intensive operation</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">performHeavyComputation</span><span class="p">();</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="nx">result</span> <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Function that simulates a resource-intensive operation</span>
<span class="kd">function</span> <span class="nx">performHeavyComputation</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_SAFE_INTEGER</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sum</span> <span class="o">+=</span> <span class="nx">i</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">sum</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="preventive-measures-3">Preventive Measures</h3>
<ul>
  <li>メモリ、CPU、再起動回数、ファイルディスクリプタ、およびプロセスの制限を簡単に行うために、コンテナやサーバーレスコード（Lambdaなど）などを使用。</li>
  <li>文字列の最大長、配列の要素数の最大値、アップロードファイルの最大サイズなど、全ての受信パラメータとペイロードのデータに最大サイズを定義し、強制する。</li>
  <li>クライアントがAPIとのやり取りを定義された時間枠内で何回行えるかを制限する（レート制限）。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span><span class="nx">省略</span><span class="p">...</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="c1">// Apply rate limiting middleware</span>
<span class="kd">const</span> <span class="nx">limiter</span> <span class="o">=</span> <span class="nx">rateLimit</span><span class="p">({</span>
  <span class="na">windowMs</span><span class="p">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">// 1 minute window</span>
  <span class="na">max</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="c1">// limit each IP to 100 requests per windowMs</span>
<span class="p">});</span>

<span class="c1">// Apply rate limiting to all requests</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">limiter</span><span class="p">);</span>
<span class="c1">// Rest of your application routes and logic</span>
<span class="p">...</span>
</code></pre></div></div>
<ul>
  <li>レート制限はビジネスのニーズに基づいて調整する必要がある。一部のAPIエンドポイントではより厳しいポリシーが必要な場合がある。</li>
  <li>同じAPIクライアント/ユーザーが特定の操作（例：OTPの検証、ワンタイムURLを訪れずにPWリカバリを要求など）を実行できる回数や頻度を制限。</li>
  <li>応答で返されるレコード数を制御するクエリ文字列とリクエストボディパラメータのサーバーサイドでの適切なバリデーションを追加。</li>
  <li>全てのサービスプロバイダー/API統合のために<font color="red">支出制限を設定する。支出制限を設定できない場合は、代わりに請求アラートを設定</font>。</li>
</ul>

<h2 id="api5-broken-function-level-authorization">API5 Broken Function Level Authorization</h2>
<h3 id="vulnerable-behaviors-3">Vulnerable Behaviors</h3>
<ul>
  <li>一般ユーザーは管理用のエンドポイントにアクセスできるか？</li>
  <li>ユーザーは、HTTPメソッドを変更するだけで（GETからDELETEなど）、アクセス権限のない操作（作成、変更、削除など）を実行できるか？</li>
  <li>グループXのユーザーは、エンドポイントのURLやパラメーターを推測するだけで、本来グループYのユーザーだけがアクセスできる機能にアクセスできるか（例：/api/v1/users/export_all）？</li>
</ul>

<h3 id="attack-example-4">Attack Example</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 擬似的なユーザーデータベース</span>
<span class="kd">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Alice</span><span class="dl">'</span><span class="p">,</span> <span class="na">role</span><span class="p">:</span> <span class="dl">'</span><span class="s1">user</span><span class="dl">'</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Bob</span><span class="dl">'</span><span class="p">,</span> <span class="na">role</span><span class="p">:</span> <span class="dl">'</span><span class="s1">admin</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">];</span>

<span class="c1">// ユーザー情報を取得するAPIエンドポイント</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/users/:id</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">userId</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">user</span> <span class="o">=&gt;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">userId</span><span class="p">);</span>

  <span class="c1">// ユーザーが存在しない場合はエラーを返す</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">User not found</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// ユーザーが管理者権限を持っていない場合でもユーザー情報を返す（セキュリティチェック漏れ）</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>
<h3 id="preventice-mesures">Preventice Mesures</h3>
<ul>
  <li>アクセス制御のメカニズムは、デフォルトですべてのアクセスを拒否し、特定の役割へのアクセスに明示的な権限付与を必要とする。</li>
  <li>アプリのビジネスロジックとグループの階層を考慮しながら、APIエンドポイントを関数レベルの認可の欠陥に対してレビューをする。</li>
  <li>管理コントローラーは、ユーザーのグループ/役割に基づいて認可チェックを実装する管理用の抽象コントローラーを継承するようにする。</li>
  <li>通常のコントローラー内の管理機能は、ユーザーのグループと役割に基づいた認可チェックを実装するようにする。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span><span class="nx">省略</span><span class="p">...</span>
  <span class="c1">// ユーザーが存在しない場合はエラーを返す</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">User not found</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="c1">// ユーザーの権限をチェックする（認可）</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isAdmin</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Unauthorized</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// ユーザー情報を返す</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// ユーザーが管理者権限を持っているかどうかを判定するヘルパー関数</span>
<span class="kd">function</span> <span class="nx">isAdmin</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">user</span><span class="p">.</span><span class="nx">role</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">admin</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="api6-unrestricted-access-to-sensitive-business-flows">API6 Unrestricted Access to Sensitive Business Flows</h2>
<h3 id="vulnerable-behaviors-4">Vulnerable Behaviors</h3>
<ul>
  <li>商品の購入フローでは、攻撃者は高需要商品の在庫を一度に購入して、高値で転売することができる（スケーリング攻撃）。</li>
  <li>コメント/投稿のフローでは、攻撃者はシステムにスパムを送ることができる。</li>
  <li>予約の作成では、攻撃者は利用可能な時間枠を全て予約し、他のユーザーがシステムを利用できないようにすることができる。</li>
</ul>

<h3 id="attack-example-5">Attack Example</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 擬似的な在庫管理データベース</span>
<span class="kd">let</span> <span class="nx">stock</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="c1">// 擬似的な購入APIエンドポイント</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/purchase</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// 在庫がない場合はエラーを返す</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">stock</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Out of stock</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// 在庫を減らす</span>
  <span class="nx">stock</span><span class="o">--</span><span class="p">;</span>
  <span class="c1">// 購入が成功したメッセージを返す</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Purchase successful</span><span class="dl">'</span> <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>
<h3 id="preventice-measures">Preventice Measures</h3>
<ul>
  <li>ビジネス: ビジネスに過度に使用される場合に損害を与える可能性のあるビジネスフローを特定。</li>
  <li>エンジニアリング: ビジネスリスクを軽減するために適切な保護メカニズムを選択。
    <ul>
      <li>デバイスのフィンガープリント: 脅威アクターがより高度なソリューションを使用する必要があるため、予期しないクライアントデバイス（ヘッドレスブラウザなど）に対してサービスを拒否。</li>
      <li>人間の検出: captchaやより高度なバイオメトリックソリューション（タイピングパターンなど）を使用。</li>
      <li>非人間のパターン: ユーザーフローを分析し、非人間のパターン（例：「カートに追加」と「購入完了」の機能へのアクセスが1秒未満で行われるなど）を検出。</li>
      <li>Torの出口ノードやよく知られたプロキシのIPアドレスをブロック。</li>
    </ul>
  </li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span><span class="nx">省略</span><span class="p">...</span>
  <span class="c1">// 同じユーザーからの連続した購入リクエストを制限する</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isRequestLimitReached</span><span class="p">(</span><span class="nx">userId</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">429</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Too many requests</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// 在庫を減らす</span>
  <span class="nx">stock</span><span class="o">--</span><span class="p">;</span>
  <span class="c1">// 購入が成功したメッセージを返す</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Purchase successful</span><span class="dl">'</span> <span class="p">});</span>
<span class="p">});</span>
<span class="c1">// ユーザーごとのリクエスト制限を管理するオブジェクト</span>
<span class="kd">const</span> <span class="nx">requestLimits</span> <span class="o">=</span> <span class="p">{};</span>
<span class="c1">// 同じユーザーからの連続した購入リクエストを制限する関数</span>
<span class="kd">function</span> <span class="nx">isRequestLimitReached</span><span class="p">(</span><span class="nx">userId</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">limit</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// 同じユーザーからの許可される連続したリクエストの最大数</span>
  <span class="c1">// ユーザーのカウンタをインクリメント</span>
  <span class="nx">requestLimits</span><span class="p">[</span><span class="nx">userId</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">requestLimits</span><span class="p">[</span><span class="nx">userId</span><span class="p">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// カウンタが制限を超えている場合はtrueを返す</span>
  <span class="k">return</span> <span class="nx">requestLimits</span><span class="p">[</span><span class="nx">userId</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">limit</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="api7-server-side-request-forgery">API7 Server Side Request Forgery</h2>
<h3 id="attack-example-6">Attack Example</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// プロフィール画像のアップロードAPIエンドポイント</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/profile/upload_picture</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">pictureUrl</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">picture_url</span><span class="p">;</span>

  <span class="c1">// SSRF攻撃の脆弱性があるコード</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">pictureUrl</span><span class="p">);</span>
    <span class="c1">// レスポンスの処理（例えば、レスポンス時間を判定するなど）</span>
    <span class="c1">// ... </span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Picture uploaded successfully</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Failed to upload picture</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>
<h3 id="preventive-measures-4">Preventive Measures</h3>
<ul>
  <li>NW内のリソース取得メカニズムを分離。通常、これらの機能は内部のリソースではなく、リモートのリソースを取得することを目的としている。</li>
  <li>可能な限り、以下の許可リストを使用:
    <ul>
      <li>ユーザーがリソースをダウンロードすることが期待されるリモート元（例：Google Drive、Gravatarなど）</li>
      <li>URLスキームとポート</li>
      <li>特定の機能に対して許可されるメディアタイプ</li>
    </ul>
  </li>
  <li>HTTPリダイレクションを無効にする。</li>
  <li>URLの解析の一貫性に起因する問題を回避するため、信頼性の高いURLパーサーを使用。</li>
  <li>クライアントからの入力データを検証し、無害化する。</li>
  <li>クライアントに生のレスポンスを送信しない。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// プロフィール画像のアップロードAPIエンドポイント</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/profile/upload_picture</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">pictureUrl</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">picture_url</span><span class="p">;</span>

  <span class="c1">// 信頼されたドメインのみを許可するフィルタリング</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isAllowedDomain</span><span class="p">(</span><span class="nx">pictureUrl</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Invalid picture URL</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">pictureUrl</span><span class="p">);</span>
    <span class="c1">// レスポンスの処理</span>
    <span class="c1">// ... </span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Picture uploaded successfully</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Failed to upload picture</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// 信頼されたドメインのフィルタリング関数</span>
<span class="kd">function</span> <span class="nx">isAllowedDomain</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 許可されたドメインのリストを定義</span>
  <span class="kd">const</span> <span class="nx">allowedDomains</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">example.com</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">example.net</span><span class="dl">'</span><span class="p">];</span>

  <span class="c1">// URLからホスト部分を抽出</span>
  <span class="kd">const</span> <span class="nx">host</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">hostname</span><span class="p">;</span>

  <span class="c1">// ホストが許可されたドメインのリストに含まれているかをチェック</span>
  <span class="k">return</span> <span class="nx">allowedDomains</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">host</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="api8-security-misconfiguration">API8 Security Misconfiguration</h2>
<h3 id="vulnerable-behavors">Vulnerable Behavors</h3>
<ul>
  <li>APIスタックのどの部分でも適切なセキュリティ強化が欠けているか、またはクラウドサービスの権限が適切に設定されていない場合。</li>
  <li>最新のセキュリティパッチが欠けているか、システムが最新ではない場合。</li>
  <li>不要な機能が有効になっている（例：HTTP動詞、ロギング機能）。</li>
  <li>HTTPサーバーチェーン内のサーバーによって着信リクエストの処理方法に不整合がある。</li>
  <li>Transport Layer Security (TLS) が欠けている。</li>
  <li>セキュリティやキャッシュ制御の指示がクライアントに送信されていない。</li>
  <li>Cross-Origin Resource Sharing (CORS) ポリシーが欠けているか、不適切に設定されている。</li>
  <li>エラーメッセージにスタックトレースが含まれているか、他の機密情報が露出している。</li>
</ul>

<h3 id="attack-example-7">Attack Example</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ロギングミドルウェアの設定</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">loggingMiddleware</span><span class="p">);</span>

<span class="c1">// ヘルスチェックAPIエンドポイント</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/health</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Server is healthy</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ログ出力ミドルウェア</span>
<span class="kd">function</span> <span class="nx">loggingMiddleware</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">apiVersion</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">x-api-version</span><span class="dl">'</span><span class="p">];</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">path</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">statusCode</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">;</span>

  <span class="c1">// ログフォーマットの作成</span>
  <span class="kd">const</span> <span class="nx">logEntry</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">method</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">apiVersion</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">path</span><span class="p">}</span><span class="s2"> - </span><span class="p">${</span><span class="nx">statusCode</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

  <span class="c1">// サードパーティのロギングユーティリティにログエントリを書き込む</span>
  <span class="nx">writeLogEntry</span><span class="p">(</span><span class="nx">logEntry</span><span class="p">);</span>

  <span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// サードパーティのロギングユーティリティにログエントリを書き込む関数</span>
<span class="kd">function</span> <span class="nx">writeLogEntry</span><span class="p">(</span><span class="nx">logEntry</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ログエントリをファイルに書き込む（サードパーティのロギングユーティリティ）</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>
<p>セキュリティリスク：攻撃者がX-Api-Versionヘッダーを利用して、リモートサーバーからのMalicious.classオブジェクトの読み込みと実行を引き起こす可能性がある。これにより、攻撃者はサーバー上で悪意のある操作を実行できてしまう。</p>

<h3 id="preventive-mesasures">Preventive Mesasures</h3>
<p>APIライフサイクルの要点は以下の通り:</p>
<ul>
  <li>適切にロックダウンされた環境の迅速かつ容易な展開を可能にする、繰り返し可能な強化プロセスの導入。</li>
  <li>APIスタック全体の設定のレビューと更新を行うタスク。レビューには、オーケストレーションファイル、APIコンポーネント、クラウドサービス（例：S3バケットの権限）が含まれる。</li>
  <li>すべての環境で設定と設定の有効性を継続的に評価するための自動化プロセス。</li>
</ul>

<p>さらに:</p>
<ul>
  <li>
    <font color="red">クライアントからAPIサーバーおよび上流/下流のコンポーネントへのすべてのAPI通信は、暗号化された通信チャネル（TLS）を介して行われるようにする（内部のAPIであっても、公開APIであっても）</font>
    <p>。</p>
  </li>
  <li>
    <font color="red">各APIにアクセス可能なHTTP動詞を明示的に指定し、他のすべてのHTTP動詞を無効にする（例：HEAD）</font>
    <p>。</p>
  </li>
  <li>ブラウザベースのクライアント（例：Webアプリのフロントエンド）からアクセスされることを想定したAPIは、少なくとも以下を実装する必要があります：
    <ul>
      <li>適切なCross-Origin Resource Sharing (CORS) ポリシーの実装。</li>
      <li>適用可能なセキュリティヘッダーを含める。</li>
    </ul>
  </li>
  <li>ビジネス/機能要件を満たす形式のみが受け入れられるように、着信コンテンツの種類/データ形式を制限。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ロギングミドルウェアの設定</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">loggingMiddleware</span><span class="p">);</span>

<span class="c1">// ヘルスチェックAPIエンドポイント</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/health</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">Server is healthy</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ログ出力ミドルウェア</span>
<span class="kd">function</span> <span class="nx">loggingMiddleware</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">apiVersion</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">[</span><span class="dl">'</span><span class="s1">x-api-version</span><span class="dl">'</span><span class="p">];</span>
  <span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">path</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">statusCode</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">;</span>

  <span class="c1">// ログフォーマットの作成</span>
  <span class="kd">const</span> <span class="nx">logEntry</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">method</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">apiVersion</span><span class="p">}</span><span class="s2">/</span><span class="p">${</span><span class="nx">path</span><span class="p">}</span><span class="s2"> - </span><span class="p">${</span><span class="nx">statusCode</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

  <span class="c1">// サニタイズされたログエントリをロギングユーティリティに渡してログを書き込む</span>
  <span class="nx">writeLogEntry</span><span class="p">(</span><span class="nx">sanitizeLogEntry</span><span class="p">(</span><span class="nx">logEntry</span><span class="p">));</span>

  <span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// サードパーティのロギングユーティリティにログエントリを書き込む関数</span>
<span class="kd">function</span> <span class="nx">writeLogEntry</span><span class="p">(</span><span class="nx">logEntry</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ログエントリをファイルに書き込む（サードパーティのロギングユーティリティ）</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// ログエントリのサニタイズ処理</span>
<span class="kd">function</span> <span class="nx">sanitizeLogEntry</span><span class="p">(</span><span class="nx">logEntry</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ログエントリをサニタイズする処理を実装する</span>
  <span class="c1">// 例えば、特殊文字のエスケープや入力の正規化を行う</span>
  <span class="c1">// 具体的な実装は、セキュリティポリシーや要件に基づきます</span>
  <span class="kd">const</span> <span class="nx">sanitizedLogEntry</span> <span class="o">=</span> <span class="c1">// サニタイズされたログエントリ</span>
  <span class="k">return</span> <span class="nx">sanitizedLogEntry</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// サーバーを起動</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Server started on port 3000</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div></div>
<ul>
  <li>HTTPサーバーチェーン（LB、リバース/フォワードプロキシ、BEサーバーなど）の<font color="red">すべてのサーバーが一貫した方法で着信リクエストを処理するようにし、デシンクの問題を回避する</font>。</li>
  <li>該当する場合、攻撃者に送り返される例外トレースや他の貴重な情報を防ぐため、すべてのAPIのレスポンスペイロードスキーマ（エラーレスポンスを含む）を定義し、強制する。</li>
</ul>

<h2 id="api9-improper-inventory-management">API9 Improper Inventory Management</h2>
<h3 id="下記該当する場合は盲点が存在する">下記該当する場合は盲点が存在する</h3>
<p>文書上の盲点：</p>

<ul>
  <li>APIホストの目的が明確ではなく、以下の質問に明確な回答がない場合：
    <ul>
      <li>APIはどの環境で実行されているか（例：本番、ステージング、テスト、開発）？</li>
      <li>APIへのNWアクセスは誰が持つべきですか（例：公開、内部、パートナー）？</li>
      <li>実行中のAPIバージョンは何か？</li>
    </ul>
  </li>
  <li>ドキュメンテーションが存在しないか、既存のドキュメンテーションが更新されてない。</li>
  <li>各APIバージョンの廃止計画がない。</li>
  <li>ホストの在庫が欠落している/更新されていない。</li>
</ul>

<p>データフロー上の盲点</p>

<ul>
  <li>APIにおいて、第三者との間で機密データを共有する「機密データフロー」が存在するが、以下の問題点がある場合：
    <ul>
      <li>フローのビジネス上の正当性や承認が明確にされていない。</li>
      <li>フローの在庫や可視性がない状態。</li>
      <li>共有される機密データの詳細な可視性がない。</li>
    </ul>
  </li>
</ul>

<h3 id="attack-example-8">Attack Example</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// リセットトークンをブルートフォースで推測する攻撃の擬似コード</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">bruteForceResetToken</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">baseUrl</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://beta.api.socialnetwork.example.com</span><span class="dl">'</span><span class="p">;</span>

  <span class="c1">// ユーザーIDや他の必要な情報を取得するためのリクエストなどがある場合は、適宜追加してください</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">resetToken</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">padStart</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// 6桁のトークンを推測</span>

    <span class="k">try</span> <span class="p">{</span>
      <span class="c1">// リセットパスワードAPIエンドポイントにリクエストを送信</span>
      <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}</span><span class="s2">/reset_password`</span><span class="p">,</span> <span class="p">{</span> <span class="na">token</span><span class="p">:</span> <span class="nx">resetToken</span> <span class="p">});</span>

      <span class="c1">// レスポンスのステータスコードやメッセージなどをチェックし、成功したかどうかを判断する</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Password reset successfully. Token: </span><span class="p">${</span><span class="nx">resetToken</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// エラーレスポンスの場合は何もしないか、適切なエラーハンドリングを行う</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// ブルートフォース攻撃を実行</span>
<span class="nx">bruteForceResetToken</span><span class="p">();</span>
</code></pre></div></div>
<h3 id="preventive-mesures">Preventive Mesures</h3>
<ul>
  <li>APIホストの在庫を作成し、各ホストの重要な要素を文書化する。重点的には、APIの環境（本番、ステージング、テスト、開発）、ホストへのネットワークアクセス権限（公開、内部、パートナー）、およびAPIバージョンである。</li>
  <li>統合されたサービスの在庫を作成し、システム内での役割、データのやり取り（データフロー）、およびセンシティビティなどの重要な要素を文書化。</li>
  <li>APIのすべての側面（認証、エラー処理、リダイレクト、レート制限、Cross-Origin Resource Sharing（CORS）ポリシー、エンドポイントなど）を文書化する。これには、パラメータ、リクエスト、レスポンスも含まれる。</li>
  <li>公開標準を採用してドキュメンテーションを自動的に生成し、CI/CDパイプラインに組み込む。</li>
  <li>
    <font color="red">APIドキュメントは、APIの利用を許可されたユーザーのみに提供</font>
    <p>。</p>
  </li>
  <li>公開されているAPIのバージョンだけでなく、すべてのバージョンに対してAPIセキュリティ専用の外部保護措置を使用。</li>
  <li>
    <font color="red">非本番のAPIデプロイには本番データを使用しない</font>
    <p>。使用する場合は、本番と同じセキュリティ処理を適用。</p>
  </li>
  <li>より新しいAPIバージョンにセキュリティ改善が含まれる場合、古いバージョンに必要な対策を明確にするためにリスク分析を実施。たとえば、改善を互換性を壊さずに適用できるかどうか、または古いバージョンを迅速に削除してすべてのクライアントを最新バージョンに移行させる必要があるかなど。</li>
</ul>

<h2 id="api10-unsafe-consumption-of-apis">API10 Unsafe Consumption of APIs</h2>
<h3 id="vulnerable-behiviors">Vulnerable Behiviors</h3>
<ul>
  <li>他のAPIとのやり取りが暗号化されていないチャネルを介して行われている。</li>
  <li>他のAPIから取得したデータを適切に検証・無害化せずに処理したり、下流コンポーネントに渡したりしている。</li>
  <li>リダイレクションに盲目的に従っている。
+<font color="red">3rd Partyのサービスの応答を処理するために使用可能なリソースの数を制限していない</font>。</li>
  <li>
    <font color="red">3rd Partyのサービスとのやり取りにタイムアウトを実装していない</font>
    <p>。</p>
  </li>
</ul>

<h3 id="attack-example-9">Attack Example</h3>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="c1">// ユーザーからのリクエストを処理するエンドポイント</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/submit_address</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">userAddress</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">address</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// サードパーティのAPIを呼び出してユーザーの住所情報を取得</span>
    <span class="kd">const</span> <span class="nx">enrichedData</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">callThirdPartyAPI</span><span class="p">(</span><span class="nx">userAddress</span><span class="p">);</span>

    <span class="c1">// ローカルデータベースに住所情報を保存</span>
    <span class="nx">saveEnrichedData</span><span class="p">(</span><span class="nx">enrichedData</span><span class="p">);</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Address enrichment successful</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Internal server error</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// サードパーティのAPIを呼び出す関数</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">callThirdPartyAPI</span><span class="p">(</span><span class="nx">userAddress</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">thirdPartyEndpoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://third-party-api.example.com/enrich</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">thirdPartyEndpoint</span><span class="p">,</span> <span class="p">{</span> <span class="na">address</span><span class="p">:</span> <span class="nx">userAddress</span> <span class="p">});</span>

  <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ローカルデータベースに住所情報を保存する関数</span>
<span class="kd">function</span> <span class="nx">saveEnrichedData</span><span class="p">(</span><span class="nx">enrichedData</span><span class="p">)</span> <span class="p">{</span>
<span class="p">...</span><span class="nx">省略</span><span class="p">...</span>
</code></pre></div></div>
<h3 id="preventive-measures-5">Preventive Measures</h3>
<ul>
  <li>サービスプロバイダを評価する際には、彼らのAPIセキュリティの姿勢を評価。</li>
  <li>すべてのAPIのやり取りが安全な通信チャネル（TLS）を介して行われるようにする。</li>
  <li>統合されたAPIから受け取ったデータは常に検証し、適切に無害化するようにする。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">...</span><span class="nx">省略</span><span class="p">...</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>

<span class="c1">// ユーザーからのリクエストを処理するエンドポイント</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/submit_address</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">userAddress</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">address</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// サニタイズとエスケープを行った住所情報を作成</span>
    <span class="kd">const</span> <span class="nx">sanitizedAddress</span> <span class="o">=</span> <span class="nx">sanitizeAndEscape</span><span class="p">(</span><span class="nx">userAddress</span><span class="p">);</span>

    <span class="c1">// サードパーティのAPIを呼び出してユーザーの住所情報を取得</span>
    <span class="kd">const</span> <span class="nx">enrichedData</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">callThirdPartyAPI</span><span class="p">(</span><span class="nx">sanitizedAddress</span><span class="p">);</span>

    <span class="c1">// ローカルデータベースに住所情報を保存</span>
    <span class="nx">saveEnrichedData</span><span class="p">(</span><span class="nx">enrichedData</span><span class="p">);</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Address enrichment successful</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span> <span class="na">error</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Internal server error</span><span class="dl">'</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// サニタイズとエスケープを行う関数</span>
<span class="kd">function</span> <span class="nx">sanitizeAndEscape</span><span class="p">(</span><span class="nx">userInput</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 適切なサニタイズとエスケープ処理を実施する</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="nx">sanitizedInput</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// サードパーティのAPIを呼び出す関数</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">callThirdPartyAPI</span><span class="p">(</span><span class="nx">userAddress</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">thirdPartyEndpoint</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://third-party-api.example.com/enrich</span><span class="dl">'</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">thirdPartyEndpoint</span><span class="p">,</span> <span class="p">{</span> <span class="na">address</span><span class="p">:</span> <span class="nx">userAddress</span> <span class="p">});</span>

  <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// ローカルデータベースに住所情報を保存する関数</span>
<span class="kd">function</span> <span class="nx">saveEnrichedData</span><span class="p">(</span><span class="nx">enrichedData</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">dbConfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">host</span><span class="p">:</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">user</span><span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">password</span><span class="p">:</span> <span class="dl">'</span><span class="s1">password</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">database</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my_database</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">(</span><span class="nx">dbConfig</span><span class="p">);</span>

  <span class="nx">connection</span><span class="p">.</span><span class="nx">connect</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Database connection failed</span><span class="dl">'</span><span class="p">);</span>
      <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// パラメータのプレースホルダ化: SQLクエリを実行する際には、パラメータをプレースホルダ化して、データベースクエリとパラメータを分離し、SQLインジェクション攻撃を防止</span>
    <span class="kd">const</span> <span class="nx">query</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">INSERT INTO addresses (street, city, state, country) VALUES (?, ?, ?, ?)</span><span class="dl">'</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">values</span> <span class="o">=</span> <span class="p">[</span><span class="nx">enrichedData</span><span class="p">.</span><span class="nx">street</span><span class="p">,</span> <span class="nx">enrichedData</span><span class="p">.</span><span class="nx">city</span><span class="p">,</span> <span class="nx">enrichedData</span><span class="p">.</span><span class="nx">state</span><span class="p">,</span> <span class="nx">enrichedData</span><span class="p">.</span><span class="nx">country</span><span class="p">];</span>

    <span class="nx">connection</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">values</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">Error saving enriched data</span><span class="dl">'</span><span class="p">);</span>
        <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Enriched data saved successfully</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="nx">connection</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="p">...</span><span class="nx">省略</span><span class="p">...</span>
</code></pre></div></div>
<ul>
  <li>統合されたAPIがリダイレクトする可能性のあるよく知られた場所を許可リストで管理し、盲目的にリダイレクトに従わないようにする。</li>
</ul>

<h2 id="references">References</h2>
<ul>
  <li><a href="https://www.anquanke.com/post/id/288466">OWASP API Security Top 10 (2023-RC更新)</a></li>
</ul>

      </article>

      
        <div class="blog-tags">
          <span>Tags:</span>
          
            <a href="/tags#owasp">owasp</a>
          
            <a href="/tags#top10">top10</a>
          
        </div>
      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=OWASP+API+Security+Top+10+Study&url=http%3A%2F%2Flocalhost%3A4000%2Fsecurity%2F2023-06-20-owasp-api-security-top10-study"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  
    <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fsecurity%2F2023-06-20-owasp-api-security-top10-study"
      class="btn btn-social-icon btn-facebook" title="Share on Facebook">
      <span class="fab fa-fw fa-facebook" aria-hidden="true"></span>
      <span class="sr-only">Facebook</span>
    </a>
  

  

  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/study/2023-05-30-cissp-chapter20" data-toggle="tooltip" data-placement="top" title="Chapter 20 Software Development Security">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/security/2023-06-24-owasp-top10" data-toggle="tooltip" data-placement="top" title="OWASP Top 10">Next Post &rarr;</a>
        </li>
        
      </ul>
      
  <div class="disqus-comments">
  <div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
	  var disqus_shortname = 'guaiguailei-net';
	  /* ensure that pages with query string get the same discussion */
	  var url_parts = window.location.href.split("?");
	  var disqus_url = url_parts[0];
	  (function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	  })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</div>
  
  

  


  

  



    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      
<ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="mailto:liuganxiang@hotmail.com" title="Email me">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Email me</span>
   </a>
  </li><li class="list-inline-item">
    <a href="/feed.xml" title="RSS">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">RSS</span>
    </a>
  </li><li class="list-inline-item">
    <a href="https://www.facebook.com/liuganxiang" title="Facebook">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-facebook fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Facebook</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://github.com/ichiliu" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/gxliu" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        Ganxiang Liu
        &nbsp;&bull;&nbsp;
      
      2023

      
        &nbsp;&bull;&nbsp;
        <span class="author-site">
          <a href="http://localhost:4000/">guaiguailei.net</a>
        </span>
      

      

      

      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
